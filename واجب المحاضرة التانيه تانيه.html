<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> ثانوي تسليم الواجب - مستر فيصل</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --primary: #6a11cb;
  --secondary: #2575fc;
  --accent: #ff6b6b;
  --success: #1dd1a1;
  --warning: #feca57;
  --light: #f8f9fa;
  --dark: #343a40;
  --card-bg: #ffffff;
  --text-primary: #2d3436;
  --text-secondary: #636e72;
  --shadow: 0 10px 30px rgba(0,0,0,0.1);
  --gradient: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Cairo', sans-serif;
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  margin: 0;
  padding: 20px;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
  user-select: none;
  color: var(--text-primary);
  line-height: 1.6;
}

.container {
  width: 100%;
  max-width: 900px;
  margin: 20px auto;
}

.card {
  background: var(--card-bg);
  border-radius: 20px;
  padding: 30px;
  margin-bottom: 25px;
  box-shadow: var(--shadow);
  animation: fadeIn 0.6s;
  transition: transform 0.3s, box-shadow 0.3s;
  border: none;
  overflow: hidden;
  position: relative;
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 40px rgba(0,0,0,0.15);
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 5px;
  background: var(--gradient);
}

h2 {
  text-align: center;
  color: var(--primary);
  margin-bottom: 20px;
  font-size: 28px;
  font-weight: 700;
  position: relative;
  padding-bottom: 15px;
}

h2::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 80px;
  height: 4px;
  background: var(--gradient);
  border-radius: 2px;
}

.input-group {
  margin-bottom: 20px;
  position: relative;
}

.input-group i {
  position: absolute;
  left: 15px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-secondary);
  font-size: 18px;
}

input {
  width: 100%;
  padding: 16px 20px 16px 50px;
  margin: 8px 0;
  border-radius: 12px;
  border: 2px solid #e0e0e0;
  font-size: 16px;
  transition: all 0.3s;
  background: #f8f9fa;
}

input:focus {
  border-color: var(--primary);
  outline: none;
  box-shadow: 0 0 0 3px rgba(106, 17, 203, 0.1);
  background: #fff;
}

button {
  width: 100%;
  padding: 16px;
  margin: 10px 0;
  background: var(--gradient);
  color: #fff;
  border: none;
  border-radius: 12px;
  font-size: 18px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  position: relative;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: 0.5s;
}

button:hover::before {
  left: 100%;
}

button:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.2);
}

button:active {
  transform: translateY(0);
}

#onlineSubmit {
  background: linear-gradient(135deg, #25D366 0%, #1ebe5d 100%);
}

#onlineSubmit:hover {
  background: linear-gradient(135deg, #1ebe5d 0%, #169c4b 100%);
}

#centerSubmit {
  background: linear-gradient(135deg, var(--primary) 0%, #4a148c 100%);
}

#centerSubmit:hover {
  background: linear-gradient(135deg, #4a148c 0%, #380a6d 100%);
}

.question-container {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  min-height: 500px;
}

.question-card {
  border: 2px solid #d1c4e9;
  background: #f9f5ff;
  padding: 25px;
  border-radius: 15px;
  width: 100%;
  max-width: 700px;
  display: none;
  box-shadow: 0 5px 15px rgba(0,0,0,0.05);
  transition: all 0.3s;
}

.question-card.active {
  display: block;
  animation: slideIn 0.5s;
}

.question-card p {
  font-size: 18px;
  margin-bottom: 20px;
  color: var(--text-primary);
  font-weight: 600;
  line-height: 1.5;
}

.question-image {
  max-width: 100%;
  margin: 15px 0;
  border-radius: 10px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  display: block;
}

.options {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.options label {
  display: flex;
  align-items: center;
  margin: 8px 0;
  padding: 15px;
  background: #ede7f6;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s;
  border: 2px solid transparent;
}

.options label:hover {
  background: #e1d5f7;
  transform: translateX(5px);
}

.options input {
  margin-left: 10px;
  width: 20px;
  height: 20px;
}

.options input:checked + span {
  background: #d1c4e9;
  transform: scale(1.02);
  border-color: var(--primary);
}

.options span {
  padding: 5px 10px;
  border-radius: 8px;
  transition: all 0.2s;
  flex-grow: 1;
}

.nav-buttons {
  display: flex;
  justify-content: space-between;
  margin-top: 25px;
  gap: 15px;
}

.nav-buttons button {
  width: auto;
  flex: 1;
}

#resultCard {
  display: none;
}

#qrContainer {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  margin: 20px auto;
  width: 260px;
  height: 260px;
  background: #fff;
  border-radius: 15px;
  padding: 15px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  border: 2px solid #e0e0e0;
}

#studentInfo {
  margin-top: 15px;
  font-size: 16px;
  text-align: center;
  white-space: pre-line;
  background: #f8f9fa;
  padding: 15px;
  border-radius: 12px;
  line-height: 1.8;
}

.correct {
  color: #1dd1a1;
  font-weight: bold;
}

.wrong {
  color: #ff6b6b;
  font-weight: bold;
}

#gifStart, #gifLoading {
  display: none;
  width: 300px;
  height: 300px;
  margin: 0 auto;
  text-align: center;
}

#gifMessage {
  text-align: center;
  font-weight: bold;
  color: var(--primary);
  margin-top: 15px;
  font-size: 20px;
}

.privacy-container {
  display: flex;
  align-items: center;
  margin: 15px 0;
  padding: 10px;
  background: #f8f9fa;
  border-radius: 10px;
}

.privacy-container input[type=checkbox] {
  margin-left: 10px;
  transform: scale(1.5);
  cursor: pointer;
}

.privacy-container a {
  color: var(--primary);
  font-weight: bold;
  text-decoration: none;
  transition: all 0.3s;
}

.privacy-container a:hover {
  color: var(--secondary);
  text-decoration: underline;
}

.exam-info {
  text-align: center;
  margin-top: 20px;
  padding: 15px;
  background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
  border-radius: 15px;
  font-weight: bold;
  box-shadow: 0 5px 15px rgba(0,0,0,0.05);
}

.exam-info p {
  margin: 8px 0;
  color: var(--primary);
  font-size: 16px;
}

.completed-message {
  text-align: center;
  padding: 25px;
  background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
  border-radius: 15px;
  margin: 25px 0;
  display: none;
  box-shadow: 0 5px 15px rgba(0,0,0,0.05);
  border: 2px solid #c5e1a5;
}

.completed-message p {
  font-size: 20px;
  color: #2e7d32;
  font-weight: bold;
  margin-bottom: 15px;
}

.submit-button-container {
  display: none;
  margin-top: 25px;
}

.important-note {
  background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
  padding: 20px;
  border-radius: 15px;
  margin: 20px 0;
  border: 2px solid #ffcc80;
  text-align: center;
  font-weight: 600;
  color: #e65100;
  box-shadow: 0 5px 15px rgba(0,0,0,0.05);
}

.important-note h3 {
  color: #e65100;
  margin-bottom: 10px;
  font-size: 20px;
}

.progress-bar {
  width: 100%;
  background: #e0e0e0;
  height: 10px;
  border-radius: 5px;
  margin: 15px 0;
  overflow: hidden;
}

.progress {
  height: 100%;
  background: var(--gradient);
  border-radius: 5px;
  transition: width 0.5s;
}

.question-counter {
  text-align: center;
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: 15px;
  font-size: 16px;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideIn {
  from { 
    opacity: 0;
    transform: translateY(20px);
  }
  to { 
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

@media (max-width: 768px) {
  .container {
    width: 95%;
    margin: 10px auto;
  }
  
  .card {
    padding: 20px;
  }
  
  h2 {
    font-size: 24px;
  }
  
  .nav-buttons {
    flex-direction: column;
  }
  
  .question-card {
    padding: 20px;
  }
}
</style>
</head>
<body oncontextmenu="return false;">
<div class="container">

<!-- GIF البداية -->
<div id="gifStart">
<script src="https://unpkg.com/@lottiefiles/dotlottie-wc@0.6.2/dist/dotlottie-wc.js" type="module"></script>
<dotlottie-wc src="https://lottie.host/6c635af3-0ee0-46cc-9591-53d8df9c6044/7cuWsYrWj2.lottie" style="width:300px;height:300px;" speed="1" autoplay loop></dotlottie-wc>
<div id="gifMessage">يلا نختار نوع الطالب يا بطل 💪</div>
</div>

<!-- GIF تحميل الواجب -->
<div id="gifLoading">
<dotlottie-wc src="https://lottie.host/5829b1a2-22e2-4d58-ad28-3812b8290c8e/BXr2Nt8kFD.lottie" style="width:300px;height:300px;" speed="1" autoplay loop></dotlottie-wc>
<div id="gifMessage">يلا نعمل الواجب يا بطل 🚀</div>
</div>

<div class="card" id="startCard">
<h2>اختر نوع الطالب</h2>
<button onclick="selectType('online')"><i class="fas fa-mobile-alt"></i> 📱 اونلاين</button>
<button onclick="selectType('center')"><i class="fas fa-school"></i> 🏫 سنتر</button>
</div>

<div class="card" id="formCard" style="display:none;">
<h2>املأ بياناتك</h2>
<div class="input-group">
  <i class="fas fa-user"></i>
  <input type="text" id="studentName" placeholder="الاسم">
</div>
<div class="input-group">
  <i class="fas fa-phone"></i>
  <input type="text" id="studentMobile" placeholder="رقم الموبايل">
</div>
<div class="input-group" id="centerCodeGroup" style="display:none;">
  <i class="fas fa-key"></i>
  <input type="text" id="centerCode" placeholder="كود السنتر">
</div>
<div class="privacy-container">
  <input type="checkbox" id="privacyCheck">
  <label for="privacyCheck">أوافق على <a href="https://www.mrfaisal.net/privacy.html" target="_blank">سياسة الخصوصية</a></label>
</div>
<button onclick="startHomework()"><i class="fas fa-play"></i> ابدأ الواجب</button>
</div>

<div class="card" id="homeworkCard" style="display:none;">
<h2> الواجب </h2>
  
<div class="important-note">
  <h3><i class="fas fa-exclamation-circle"></i> تنبيه هام</h3>
  <p>🚫 الي ترقيم السؤال مثال( 1-السؤال رقم 50 )شوف السؤال رقم( 50 )في المذكرة وابدأ حل السؤال ركز في الترقيم كويس بالتوفيق يابطل ❤️</p>
</div>

<div class="question-counter" id="questionCounter">السؤال 1 من 10</div>
<div class="progress-bar">
  <div class="progress" id="progressBar" style="width: 10%"></div>
</div>

<div class="question-container" id="homeworkForm"></div>

<div class="completed-message" id="completedMessage">
  <p><i class="fas fa-trophy"></i> مبروك! خلصت كل الأسئلة</p>
  <p>دلوقتي تقدر تسلم واجبك اضغط علي سلم الواجب علشان تاخد qr بتاعك</p>
</div>

<div class="nav-buttons">
  <button id="prevQuestion" onclick="prevQuestion()"><i class="fas fa-arrow-right"></i> السؤال السابق</button>
  <button id="nextQuestion" onclick="nextQuestion()">التالي <i class="fas fa-arrow-left"></i></button>
</div>

<div class="submit-button-container" id="submitButtonContainer">
  <button id="centerSubmit" style="display:none;" onclick="submitHomework()"><i class="fas fa-paper-plane"></i> سلم الواجب</button>
  <button id="onlineSubmit" style="display:none;" onclick="submitOnline()"><i class="fas fa-laptop"></i> سلم واجبك أونلاين</button>
</div>
</div>

<div class="card" id="resultCard">
<h2>تم التصحيح 🎉</h2>

<!-- QR -->
<div id="qrContainer"></div>

<!-- معلومات ميعاد الامتحان -->
<div class="exam-info">
  <p><i class="far fa-calendar-alt"></i> تاريخ ووقت تسليم الواجب:</p>
  <p id="submissionDate"></p>
  <p id="submissionTime"></p>
</div>

<p style="text-align:center;font-weight:bold;color:var(--primary);margin-top:15px; line-height:1.6;">
  <i class="fas fa-qrcode"></i> ده QR بتاعك خده اسكرين شوت ضروري علشان لو انت طالب سنتر مش هتدخل الحصه الا بيه ولو انت طالب اونلاين انزل اخر الصفحة وابعتلنا الاسكرين علي الواتس اب ملحوظة خد ال QR سكرين شوت📱
</p>

<!-- تصحيح الأسئلة -->
<div id="answersReview"></div>

<!-- بيانات الطالب -->
<div id="studentInfo"></div>

<!-- نصيحة الطالب -->
<div id="advice" style="text-align:center;font-size:18px;margin-top:15px;color:var(--primary);font-weight:bold"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/kjua@0.1.1/dist/kjua.min.js"></script>
<script>
let homeworkData=[];
let studentType="";
let studentQR="";
let currentQuestion=0;
let isLastQuestionReached = false;

// دالة للحصول على التاريخ والوقت الحالي لمصر مع مراعاة التوقيت الصيفي
function getEgyptDateTime() {
  const now = new Date();
  
  // تحديد إزاحة التوقيت لمصر (توقيت شرق أوروبا EET)
  // مصر تستخدم توقيت شرق أوروبا (UTC+2) والتوقيت الصيفي (UTC+3)
  let egyptOffset = 2 * 60; // التوقيت الشتوي (UTC+2)
  
  // التحقق مما إذا كان التوقيت الصيفي ساريًا (عادة من آخر جمعة في أبريل إلى آخر خميس في أكتوبر)
  const year = now.getUTCFullYear();
  const apr = new Date(Date.UTC(year, 3, 30, 22)); // أبريل
  const oct = new Date(Date.UTC(year, 9, 30, 22)); // أكتوبر
  
  // العثور على آخر جمعة في أبريل
  while (apr.getUTCDay() !== 5) {
    apr.setUTCDate(apr.getUTCDate() - 1);
  }
  
  // العثور على آخر خميس في أكتوبر
  while (oct.getUTCDay() !== 4) {
    oct.setUTCDate(oct.getUTCDate() - 1);
  }
  
  // التحقق مما إذا كان الآن خلال فترة التوقيت الصيفي
  if (now >= apr && now < oct) {
    egyptOffset = 3 * 60; // التوقيت الصيفي (UTC+3)
  }
  
  const localOffset = now.getTimezoneOffset(); // إزاحة التوقيت المحلي بالدقائق
  const egyptTime = new Date(now.getTime() + (localOffset + egyptOffset) * 60000);
  
  // الأيام بالأسبوع بالعربية
  const days = ["الأحد", "الاثنين", "الثلاثاء", "الأربعاء", "الخميس", "الجمعة", "السبت"];
  
  // الأشهر بالعربية
  const months = [
    "يناير", "فبراير", "مارس", "أبريل", "مايو", "يونيو",
    "يوليو", "أغسطس", "سبتمبر", "أكتوبر", "نوفمبر", "ديسمبر"
  ];
  
  const dayName = days[egyptTime.getDay()];
  const day = egyptTime.getDate();
  const month = months[egyptTime.getMonth()];
  const yearEgypt = egyptTime.getFullYear();
  
  // تنسيق الوقت
  let hours = egyptTime.getHours();
  const minutes = egyptTime.getMinutes().toString().padStart(2, '0');
  const ampm = hours >= 12 ? 'مساءً' : 'صباحاً';
  hours = hours % 12;
  hours = hours ? hours : 12; // الساعة 0 تصبح 12
  
  return {
    date: `${dayName} ${day} ${month} ${yearEgypt}`,
    time: `الساعة ${hours}:${minutes} ${ampm}`,
    fullDateTime: `${dayName} ${day} ${month} ${yearEgypt} - ${hours}:${minutes} ${ampm}`
  };
}

function selectType(type){
  studentType = type;
  document.getElementById('startCard').style.display="none";
  document.getElementById('gifStart').style.display="block";
  setTimeout(()=>{
    document.getElementById('gifStart').style.display="none";
    document.getElementById('formCard').style.display="block";
    document.getElementById('centerCodeGroup').style.display = (type=="center")?"block":"none";
  },2000);
}

async function startHomework(){
  const name=document.getElementById('studentName').value.trim();
  const mobile=document.getElementById('studentMobile').value.trim();
  const privacyChecked=document.getElementById('privacyCheck').checked;

  if(name=="" || mobile=="") return alert("اكمل البيانات");
  if(!privacyChecked) return alert("يجب الموافقة على سياسة الخصوصية");

  document.getElementById('formCard').style.display="none";
  document.getElementById('gifLoading').style.display="block";

  try{
    const response = await fetch("https://script.google.com/macros/s/AKfycbwfR1OqiITImsiS7eHJOxinWRYwZwEcaETog0YO1Y_YAXYiINGdw2qTiDiW7uaqvLsAaQ/exec");
    homeworkData = await response.json();

    setTimeout(()=>{
      document.getElementById('gifLoading').style.display="none";
      const form=document.getElementById('homeworkForm');
      form.innerHTML="";
      homeworkData.forEach((q,i)=>{
        let div=document.createElement("div");
        div.className="question-card";
        
        // بناء محتوى السؤال مع إمكانية وجود صورة
        let questionContent = `<p><b>${q.number}.</b> ${q.text}</p>`;
        
        // إذا كان هناك رابط صورة في العمود الثالث، نضيف الصورة
        if (q.image && q.image.trim() !== '') {
          questionContent += `<img src="${q.image}" alt="صورة السؤال ${q.number}" class="question-image" onerror="this.style.display='none'">`;
        }
        
        div.innerHTML = questionContent;
        
        let optsDiv=document.createElement("div");
        optsDiv.className="options";
        q.options.forEach(opt=>{
          optsDiv.innerHTML+=`<label><input type="radio" name="q${q.number}" value="${opt}"> <span>${opt}</span></label>`;
        });
        div.appendChild(optsDiv);
        form.appendChild(div);
      });
      document.getElementById('homeworkCard').style.display="block";
      showQuestion(0);
      updateNavigationButtons();
      updateProgressBar();
    },800);

  }catch(e){
    alert("❌ فشل تحميل الواجب");
    document.getElementById('formCard').style.display="block";
    document.getElementById('gifLoading').style.display="none";
  }
}

function showQuestion(index){
  const cards=document.querySelectorAll('.question-card');
  cards.forEach((c,i)=>c.classList.remove('active'));
  if(index>=0 && index<cards.length){
    cards[index].classList.add('active');
    currentQuestion=index;
    updateNavigationButtons();
    updateProgressBar();
  }
}

function updateProgressBar() {
  const progress = ((currentQuestion + 1) / homeworkData.length) * 100;
  document.getElementById('progressBar').style.width = `${progress}%`;
  document.getElementById('questionCounter').textContent = `السؤال ${currentQuestion + 1} من ${homeworkData.length}`;
}

function updateNavigationButtons() {
  const isFirstQuestion = currentQuestion === 0;
  const isLastQuestion = currentQuestion === homeworkData.length - 1;
  
  document.getElementById('prevQuestion').style.display = isFirstQuestion ? 'none' : 'block';
  
  if (isLastQuestion && !isLastQuestionReached) {
    document.getElementById('nextQuestion').textContent = 'إنهاء الأسئلة';
  } else if (!isLastQuestion) {
    document.getElementById('nextQuestion').textContent = 'التالي';
  }
  
  // إظهار زر التسليم في آخر سؤال
  if (isLastQuestion) {
    document.getElementById('submitButtonContainer').style.display = 'block';
    if(studentType=="online") document.getElementById('onlineSubmit').style.display="block";
    if(studentType=="center") document.getElementById('centerSubmit').style.display="block";
  } else {
    document.getElementById('submitButtonContainer').style.display = 'none';
  }
  
  // إخفاء رسالة الإكمال إذا لم يكن هذا هو السؤال الأخير
  if (!isLastQuestion) {
    document.getElementById('completedMessage').style.display = 'none';
  }
}

function nextQuestion(){
  if(currentQuestion < homeworkData.length-1) {
    showQuestion(currentQuestion+1);
  } else if(currentQuestion === homeworkData.length-1 && !isLastQuestionReached) {
    // وصلنا إلى آخر سؤال
    isLastQuestionReached = true;
    document.getElementById('nextQuestion').style.display = 'none';
    document.getElementById('completedMessage').style.display = 'block';
  }
}

function prevQuestion(){
  if(currentQuestion>0) {
    isLastQuestionReached = false;
    document.getElementById('nextQuestion').style.display = 'block';
    document.getElementById('completedMessage').style.display = 'none';
    showQuestion(currentQuestion-1);
  }
}

function submitHomework(){ generateResult(false); }
function submitOnline(){ generateResult(true); }

function generateResult(isOnline){
  const name=document.getElementById('studentName').value;
  const mobile=document.getElementById('studentMobile').value;
  const code=document.getElementById('centerCode').value || "-";
  
  // الحصول على التاريخ والوقت الحالي لمصر
  const egyptDateTime = getEgyptDateTime();

  let score=0;
  let reviewHTML="<h3 style='text-align:center; margin-bottom:20px;'>نتيجة التصحيح</h3>";
  homeworkData.forEach(q=>{
    let sel=document.querySelector(`input[name="q${q.number}"]:checked`);
    let studentAnswer=sel?sel.value:"لم تجب";
    let correct=q.correct;
    let correctClass=(studentAnswer===correct)?"correct":"wrong";
    if(correctClass==="correct") score++;
    
    // بناء محتوى مراجعة السؤال مع إمكانية وجود صورة
    let questionReviewContent = `
      <div style="padding:15px; margin:10px 0; border-radius:10px; background:#f8f9fa;">
        <p><b>${q.number}.</b> ${q.text}</p>
    `;
    
    // إذا كان هناك صورة للسؤال، نضيفها في المراجعة
    if (q.image && q.image.trim() !== '') {
      questionReviewContent += `<img src="${q.image}" alt="صورة السؤال ${q.number}" style="max-width:100%; margin:10px 0; border-radius:8px;" onerror="this.style.display='none'">`;
    }
    
    questionReviewContent += `
        <p>اختيارك: <span class="${correctClass}">${studentAnswer}</span></p>
        <p>الإجابة الصحيحة: <span style="color:green; font-weight:bold">${correct}</span></p>
      </div>
    `;
    
    reviewHTML += questionReviewContent;
  });

  // إضافة معلومات التاريخ والوقت إلى QR Code
  studentQR = `📚 واجب المحاضرة التانيه *الصف الثاني الثانوي\n✅ الطالب: ${name}\n📱: ${mobile}\n🏷 النوع: ${studentType}\n📊 الدرجة: ${score}/${homeworkData.length}\n📅 تاريخ التسليم: ${egyptDateTime.date}\n⏰ ${egyptDateTime.time}\n🔖 كود فريد: ${Math.random().toString(36).substring(2,10)}`;

  document.getElementById('homeworkCard').style.display="none";
  document.getElementById('resultCard').style.display="block";

  document.getElementById('qrContainer').innerHTML="";
  let qr = kjua({text:studentQR,size:250,render:'canvas',fill:'#4a148c',quiet:2,rounded:10});
  document.getElementById('qrContainer').appendChild(qr);

  // عرض معلومات التاريخ والوقت
  document.getElementById('submissionDate').innerText = egyptDateTime.date;
  document.getElementById('submissionTime').innerText = egyptDateTime.time;

  document.getElementById('answersReview').innerHTML = reviewHTML;
  document.getElementById('studentInfo').innerText = 
    `الاسم: ${name}\nالموبايل: ${mobile}\nالنوع: ${studentType}\nكود السنتر: ${code}\nدرجتك: ${score}/${homeworkData.length}\nوقت التسليم: ${egyptDateTime.fullDateTime}`;

  // نصيحة حسب الدرجة
  const adviceDiv = document.getElementById('advice');
  const total = homeworkData.length;
  if(score < total/2){
    adviceDiv.innerText = "😅 شد حيلك يا بطل! المرة الجاية هتكون أفضل 💪";
  } else if(score === total/2){
    adviceDiv.innerText = "🙂 كويس! بس ممكن تحسن شوي 👍";
  } else if(score > total/2){
    const phrases=["✨ أشطر شطور ✨","🐥 أشطر كتكوت 🐥","💯 ممتاز يا بطل 💯"];
    adviceDiv.innerText = phrases[Math.floor(Math.random()*phrases.length)];
  }

  if(isOnline){
    qr.toBlob(function(blob){
      const waUrl = `https://wa.me/201556618507?text=`;
      let file = new File([blob], "qr.png",{type:"image/png"});
      let reader = new FileReader();
      reader.onload = function(e){
        let imgData = e.target.result;
        let btn = document.createElement("a");
        btn.href = `https://api.whatsapp.com/send?phone=201556618507&text=الواجب&media=${encodeURIComponent(imgData)}`;
        btn.target="_blank";
        btn.id="waButton";
        btn.innerText="سلم واجبك أونلاين";
        btn.style.display="block";
        btn.style.width="100%";
        btn.style.textAlign="center";
        btn.style.padding="14px";
        btn.style.background="#25D366";
        btn.style.color="#fff";
        btn.style.marginTop="15px";
        btn.style.borderRadius="12px";
        btn.style.fontWeight="bold";
        btn.style.fontSize="16px";
        document.getElementById('resultCard').appendChild(btn);
      };
      reader.readAsDataURL(file);
    });
  }
}
</script>
</body>
</html>
