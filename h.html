<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø­Ø¶ÙˆØ± Ø§Ù„Ø·Ù„Ø§Ø¨ - Ù…Ø³ØªØ± ÙÙŠØµÙ„</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        * { font-family: 'Cairo', sans-serif; box-sizing: border-box; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin: 0; padding: 20px; min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); overflow: hidden; }
        header { background: linear-gradient(to right, #4a6fa5, #3a5a8a); color: white; padding: 25px; text-align: center; }
        .tabs { display: flex; background: #f8f9fa; border-bottom: 2px solid #e0e0e0; }
        .tab { flex: 1; padding: 18px; text-align: center; cursor: pointer; font-weight: 600; font-size: 18px; transition: all 0.3s; border-right: 1px solid #e0e0e0; }
        .tab:last-child { border-right: none; }
        .tab.active { background: white; color: #4a6fa5; border-bottom: 3px solid #4a6fa5; margin-bottom: -2px; }
        .tab-content { padding: 30px; display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 16px; }
        input, select, textarea { width: 100%; padding: 14px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 16px; transition: border 0.3s; }
        input:focus, select:focus { border-color: #4a6fa5; outline: none; }
        .btn { background: linear-gradient(to right, #4a6fa5, #3a5a8a); color: white; border: none; padding: 15px 35px; border-radius: 10px; font-size: 18px; font-weight: 600; cursor: pointer; transition: all 0.3s; margin: 10px 5px; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 7px 14px rgba(74, 111, 165, 0.3); }
        .btn-scan { background: linear-gradient(to right, #00b09b, #96c93d); }
        .btn-qr { background: linear-gradient(to right, #ff8a00, #da1b60); }
        .btn-attendance { background: linear-gradient(to right, #2196F3, #21CBF3); }
        .qr-container { text-align: center; padding: 25px; background: #f9f9f9; border-radius: 15px; margin: 20px 0; border: 2px dashed #ccc; }
        #qr-reader { width: 100%; max-width: 500px; margin: 25px auto; border: 3px solid #4a6fa5 !important; border-radius: 15px; overflow: hidden; }
        .result-box { background: #e8f5e9; padding: 20px; border-radius: 10px; margin: 20px 0; border-right: 5px solid #4CAF50; }
        .payment-status { display: flex; align-items: center; gap: 15px; margin: 20px 0; }
        .status-badge { padding: 8px 20px; border-radius: 20px; font-weight: 600; font-size: 14px; }
        .status-paid { background: #d4edda; color: #155724; }
        .status-pending { background: #f8d7da; color: #721c24; }
        .centers-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin: 20px 0; }
        .center-card { background: white; border: 2px solid #e0e0e0; border-radius: 10px; padding: 15px; cursor: pointer; transition: all 0.3s; }
        .center-card:hover { border-color: #4a6fa5; transform: translateY(-5px); }
        .center-card.selected { border-color: #4a6fa5; background: #f0f7ff; }
        @media (max-width: 768px) {
            .tabs { flex-direction: column; }
            .tab { border-right: none; border-bottom: 1px solid #e0e0e0; }
            .form-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 style="margin:0; font-size: 32px;">ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø§Ù„Ø·Ù„Ø§Ø¨ - Ù…Ø³ØªØ± ÙÙŠØµÙ„</h1>
            <p style="opacity:0.9; margin-top:10px;">Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø­Ø¶ÙˆØ± Ø§Ù„Ø³Ù†Ø§ØªØ± Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</p>
        </header>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab(1)">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</div>
            <div class="tab" onclick="switchTab(2)">ğŸ« ØªÙˆÙ„ÙŠØ¯ QR Code</div>
            <div class="tab" onclick="switchTab(3)">ğŸ“± ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±</div>
            <div class="tab" onclick="switchTab(4)">ğŸ“Š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù†Ø§ØªØ±</div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ 1: Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ -->
        <div id="tab1" class="tab-content active">
            <h2>ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯</h2>
            <div class="form-grid">
                <div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø³Ù†ØªØ±</label>
                        <div class="centers-list" id="centersContainer">
                            <!-- Ø§Ù„Ø³Ù†Ø§ØªØ± Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ù…Ù† Google Sheets -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</label>
                        <input type="text" id="studentName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">
                    </div>
                    
                    <div class="form-group">
                        <label>ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨</label>
                        <input type="text" id="studentCode" placeholder="Ù…Ø«Ù„: ST2024001">
                    </div>
                    
                    <div class="form-group">
                        <label>Ø§Ù„ØµÙ</label>
                        <select id="studentGrade">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
                            <option value="Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ">Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ</option>
                            <option value="Ø«Ø§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ">Ø«Ø§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</label>
                        <select id="studentGroup">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</option>
                            <option value="Ø£">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£</option>
                            <option value="Ø¨">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨</option>
                            <option value="Ø¬">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¬</option>
                            <option value="Ø¯">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¯</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
                        <select id="paymentMethod">
                            <option value="Ø´Ù‡Ø±ÙŠ">Ø´Ù‡Ø±ÙŠ</option>
                            <option value="Ø­ØµÙ‡">Ø¨Ø§Ù„Ø­ØµÙ‡</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</label>
                        <div class="payment-status">
                            <label style="display:flex; align-items:center; cursor:pointer;">
                                <input type="radio" name="paymentStatus" value="Ù…Ø¯ÙÙˆØ¹" checked> 
                                <span class="status-badge status-paid">Ù…Ø¯ÙÙˆØ¹</span>
                            </label>
                            <label style="display:flex; align-items:center; cursor:pointer;">
                                <input type="radio" name="paymentStatus" value="Ø¨Ø§Ù‚ÙŠ"> 
                                <span class="status-badge status-pending">Ø¨Ø§Ù‚ÙŠ Ø¹Ù„ÙŠÙ‡</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
                        <select id="currentMonth">
                            <option value="ÙŠÙ†Ø§ÙŠØ±">ÙŠÙ†Ø§ÙŠØ±</option>
                            <option value="ÙØ¨Ø±Ø§ÙŠØ±">ÙØ¨Ø±Ø§ÙŠØ±</option>
                            <option value="Ù…Ø§Ø±Ø³">Ù…Ø§Ø±Ø³</option>
                            <option value="Ø¥Ø¨Ø±ÙŠÙ„">Ø¥Ø¨Ø±ÙŠÙ„</option>
                            <option value="Ù…Ø§ÙŠÙˆ">Ù…Ø§ÙŠÙˆ</option>
                            <option value="ÙŠÙˆÙ†ÙŠÙˆ">ÙŠÙˆÙ†ÙŠÙˆ</option>
                            <option value="ÙŠÙˆÙ„ÙŠÙˆ">ÙŠÙˆÙ„ÙŠÙˆ</option>
                            <option value="Ø£ØºØ³Ø·Ø³">Ø£ØºØ³Ø·Ø³</option>
                            <option value="Ø³Ø¨ØªÙ…Ø¨Ø±">Ø³Ø¨ØªÙ…Ø¨Ø±</option>
                            <option value="Ø£ÙƒØªÙˆØ¨Ø±">Ø£ÙƒØªÙˆØ¨Ø±</option>
                            <option value="Ù†ÙˆÙÙ…Ø¨Ø±">Ù†ÙˆÙÙ…Ø¨Ø±</option>
                            <option value="Ø¯ÙŠØ³Ù…Ø¨Ø±">Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <button class="btn" onclick="addStudent()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØªÙˆÙ„ÙŠØ¯ QR Code</button>
            <button class="btn btn-qr" onclick="generateQR()">ğŸ« ØªÙˆÙ„ÙŠØ¯ QR Code ÙÙ‚Ø·</button>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ 2: ØªÙˆÙ„ÙŠØ¯ QR Code -->
        <div id="tab2" class="tab-content">
            <h2>ğŸ« ØªÙˆÙ„ÙŠØ¯ QR Code Ù„Ù„Ø·Ø§Ù„Ø¨</h2>
            <div class="form-group">
                <label>Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨</label>
                <input type="text" id="qrStudentCode" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ø·Ø§Ù„Ø¨">
            </div>
            <button class="btn btn-qr" onclick="generateQRForStudent()">ØªÙˆÙ„ÙŠØ¯ QR Code</button>
            
            <div id="qrResult" class="qr-container" style="display:none;">
                <h3>QR Code Ù„Ù„Ø·Ø§Ù„Ø¨</h3>
                <div id="qrcode"></div>
                <p id="qrStudentInfo" style="margin-top:15px;"></p>
                <button class="btn" onclick="printQR()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© QR Code</button>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ 3: ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± -->
        <div id="tab3" class="tab-content">
            <h2>ğŸ“± Ù…Ø³Ø­ QR Code Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</h2>
            
            <div id="qr-reader"></div>
            <div id="qr-reader-results" class="result-box"></div>
            
            <div style="text-align:center; margin:30px 0;">
                <h3>Ø£Ùˆ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙŠØ¯ÙˆÙŠØ§Ù‹</h3>
                <div style="max-width:400px; margin:0 auto;">
                    <input type="text" id="manualCode" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙŠØ¯ÙˆÙŠØ§Ù‹" style="margin-bottom:15px;">
                    <button class="btn btn-attendance" onclick="manualAttendance()">âœ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± ÙŠØ¯ÙˆÙŠ</button>
                </div>
            </div>
            
            <div id="attendanceResult" class="result-box" style="display:none;"></div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ 4: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù†Ø§ØªØ± -->
        <div id="tab4" class="tab-content">
            <h2>ğŸ« Ø¥Ø¶Ø§ÙØ© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù†Ø§ØªØ±</h2>
            
            <div class="form-group">
                <label>Ø§Ø³Ù… Ø§Ù„Ø³Ù†ØªØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯</label>
                <input type="text" id="newCenterName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø³Ù†ØªØ±">
            </div>
            <button class="btn" onclick="addCenter()">â• Ø¥Ø¶Ø§ÙØ© Ø³Ù†ØªØ± Ø¬Ø¯ÙŠØ¯</button>
            
            <h3 style="margin-top:40px;">Ø§Ù„Ø³Ù†Ø§ØªØ± Ø§Ù„Ù…Ø¶Ø§ÙØ©</h3>
            <div id="centersList" class="centers-list">
                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ù†Ø§ØªØ± -->
            </div>
        </div>
    </div>

    <script>
        // Ø±Ø§Ø¨Ø· Ù†Ø´Ø± Google Apps Script - Ø¶Ø¹ Ø±Ø§Ø¨Ø·Ùƒ Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø´Ø±
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbybPt-fRRjb1P_ViVGoPj2OnBNMnVFxTFZX-MYqkVu69YzUBdfFbwNCsqM-_FMWJ3yb/exec';
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù†Ø§ØªØ± Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            loadCenters();
        });
        
        // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        function switchTab(tabNumber) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById('tab' + tabNumber).classList.add('active');
            document.querySelectorAll('.tab')[tabNumber - 1].classList.add('active');
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù†Ø§ØªØ± Ù…Ù† Google Sheets
        async function loadCenters() {
            try {
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?action=getCenters`);
                const centers = await response.json();
                
                let centersHtml = '';
                centers.forEach(center => {
                    centersHtml += `
                        <div class="center-card" onclick="selectCenter('${center}')" id="center-${center}">
                            <strong>${center}</strong>
                        </div>
                    `;
                });
                
                document.getElementById('centersContainer').innerHTML = centersHtml;
                document.getElementById('centersList').innerHTML = centersHtml;
            } catch (error) {
                console.error('Error loading centers:', error);
            }
        }
        
        let selectedCenter = '';
        function selectCenter(centerName) {
            selectedCenter = centerName;
            document.querySelectorAll('.center-card').forEach(card => card.classList.remove('selected'));
            document.getElementById('center-' + centerName).classList.add('selected');
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
        async function addStudent() {
            const studentData = {
                center: selectedCenter,
                name: document.getElementById('studentName').value,
                code: document.getElementById('studentCode').value,
                grade: document.getElementById('studentGrade').value,
                group: document.getElementById('studentGroup').value,
                paymentMethod: document.getElementById('paymentMethod').value,
                paymentStatus: document.querySelector('input[name="paymentStatus"]:checked').value,
                month: document.getElementById('currentMonth').value,
                attendanceCount: 0
            };
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!studentData.center || !studentData.name || !studentData.code) {
                Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø³Ù†ØªØ± ÙˆØ§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ§Ù„ÙƒÙˆØ¯', 'warning');
                return;
            }
            
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({action: 'addStudent', ...studentData})
                });
                
                const result = await response.json();
                
                if (result.success) {
                    Swal.fire('Ù†Ø¬Ø§Ø­', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    // ØªÙˆÙ„ÙŠØ¯ QR Code Ù„Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                    generateQRForStudent(studentData.code);
                    switchTab(2);
                } else {
                    Swal.fire('Ø®Ø·Ø£', result.error || 'Ø­Ø¯Ø« Ø®Ø·Ø£', 'error');
                }
            } catch (error) {
                Swal.fire('Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±', 'error');
            }
        }
        
        // ØªÙˆÙ„ÙŠØ¯ QR Code
        function generateQRForStudent(code = null) {
            const studentCode = code || document.getElementById('qrStudentCode').value;
            
            if (!studentCode) {
                Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨', 'warning');
                return;
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ QR Code Ù…Ø­Ù„ÙŠØ§Ù‹
            const qrValue = `ATTENDANCE-${studentCode}-${Date.now()}`;
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${qrValue}`;
            
            document.getElementById('qrResult').style.display = 'block';
            document.getElementById('qrcode').innerHTML = `
                <img src="${qrUrl}" alt="QR Code" style="width:200px; height:200px;">
            `;
            document.getElementById('qrStudentInfo').textContent = `ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨: ${studentCode}`;
            
            // Ø­ÙØ¸ QR Code ÙÙŠ Google Sheets
            saveQRCode(studentCode, qrValue);
        }
        
        // Ø­ÙØ¸ QR Code
        async function saveQRCode(studentCode, qrValue) {
            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'saveQRCode',
                        studentCode: studentCode,
                        qrValue: qrValue
                    })
                });
            } catch (error) {
                console.error('Error saving QR code:', error);
            }
        }
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø§Ø³Ø­ QR Code
        function onScanSuccess(decodedText, decodedResult) {
            document.getElementById('qr-reader-results').innerHTML = `
                <h4>âœ… ØªÙ… Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­</h4>
                <p>ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨: ${decodedText}</p>
                <button class="btn btn-attendance" onclick="registerAttendance('${decodedText}')">
                    âœ… ØªØ£ÙƒÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±
                </button>
            `;
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±
        async function registerAttendance(studentCode) {
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'registerAttendance',
                        studentCode: studentCode,
                        date: new Date().toLocaleDateString('ar-EG'),
                        time: new Date().toLocaleTimeString('ar-EG')
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('attendanceResult').style.display = 'block';
                    document.getElementById('attendanceResult').innerHTML = `
                        <h4>âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­</h4>
                        <p>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨: ${result.studentName}</p>
                        <p>Ø§Ù„Ø³Ù†ØªØ±: ${result.center}</p>
                        <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¶ÙˆØ±: ${result.date}</p>
                        <p>ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±: ${result.time}</p>
                        <p>Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±: ${result.attendanceCount}</p>
                    `;
                }
            } catch (error) {
                Swal.fire('Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±', 'error');
            }
        }
        
        // Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠØ¯ÙˆÙŠ
        function manualAttendance() {
            const code = document.getElementById('manualCode').value;
            if (code) {
                registerAttendance(code);
            }
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø³Ù†ØªØ± Ø¬Ø¯ÙŠØ¯
        async function addCenter() {
            const centerName = document.getElementById('newCenterName').value;
            
            if (!centerName) {
                Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø³Ù†ØªØ±', 'warning');
                return;
            }
            
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'addCenter',
                        centerName: centerName
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    Swal.fire('Ù†Ø¬Ø§Ø­', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ù†ØªØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    document.getElementById('newCenterName').value = '';
                    loadCenters();
                }
            } catch (error) {
                Swal.fire('Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ù†ØªØ±', 'error');
            }
        }
        
        // Ø·Ø¨Ø§Ø¹Ø© QR Code
        function printQR() {
            const printContent = document.getElementById('qrResult').innerHTML;
            const originalContent = document.body.innerHTML;
            
            document.body.innerHTML = `
                <div style="text-align:center; padding:50px;">
                    <h2>ğŸ« ÙƒÙˆØ¯ Ø­Ø¶ÙˆØ± Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
                    ${printContent}
                    <p style="margin-top:30px;">Ù†Ø¸Ø§Ù… Ø­Ø¶ÙˆØ± Ù…Ø³ØªØ± ÙÙŠØµÙ„ - ${new Date().toLocaleDateString('ar-EG')}</p>
                </div>
            `;
            
            window.print();
            document.body.innerHTML = originalContent;
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ù…Ø§Ø³Ø­ QR Code Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
        document.querySelector('.tab[onclick="switchTab(3)"]').addEventListener('click', function() {
            setTimeout(() => {
                const html5QrCode = new Html5Qrcode("qr-reader");
                html5QrCode.start(
                    { facingMode: "environment" },
                    { fps: 10, qrbox: 250 },
                    onScanSuccess
                );
            }, 500);
        });
    </script>
</body>
</html>
