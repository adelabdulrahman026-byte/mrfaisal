<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø´Ø±Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬</title>
<style>
  body {
    font-family: 'Cairo', sans-serif;
    margin: 0;
    padding: 0;
    text-align: center;
  }
  video {
    max-width: 100%;
    height: auto;
    margin-bottom: 10px;
  }
  form {
    max-width: 500px;
    margin: auto;
    background: #f9f9f9;
    padding: 15px;
    border-radius: 10px;
  }
  input, select, button {
    width: 100%;
    padding: 8px;
    margin: 5px 0;
    font-size: 16px;
  }
  #successPopup {
    position: fixed;
    bottom: -100%;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0px 0px 10px #aaa;
    transition: bottom 0.3s ease;
    width: 90%;
    max-width: 350px;
    text-align: center;
  }
  #successPopup.show {
    bottom: 20px;
  }
  .loading-msg {
    font-size: 18px;
  }
  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
  }
</style>
</head>
<body>

<!-- Ø£Ø²Ø±Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†ØªØ¬ -->
<button onclick="startOrder('third')">ğŸ“˜ Ù…Ø°ÙƒØ±Ø© Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</button>
<button onclick="startOrder('second')">ğŸ“™ Ù…Ø°ÙƒØ±Ø© Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</button>
<button onclick="startOrder('akodna')">ğŸ’» Ø£ÙƒÙˆØ§Ø¯Ù†Ø§</button>

<!-- Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
<div id="video_third" style="display:none;">
  <video controls>
    <source src="https://files.catbox.moe/lgvvn8.mp4" type="video/mp4">
  </video>
</div>
<div id="note_third" style="display:none;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø°ÙƒØ±Ø© Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</div>

<div id="video_second" style="display:none;">
  <video controls>
    <source src="https://files.catbox.moe/lgvvn8.mp4" type="video/mp4">
  </video>
</div>
<div id="note_second" style="display:none;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø°ÙƒØ±Ø© Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</div>

<div id="video_akodna" style="display:none;">
  <video controls>
    <source src="https://files.catbox.moe/lgvvn8.mp4" type="video/mp4">
  </video>
</div>
<div id="note_akodna" style="display:none;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</div>

<!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø·Ù„Ø¨ -->
<form id="orderForm" style="display:none;">
  <input type="text" id="name" placeholder="Ø§Ù„Ø§Ø³Ù…" required>
  <input type="text" id="gov" placeholder="Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©" required>
  <input type="tel" id="phone1" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required>
  <input type="text" id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
  <select id="codeType" style="display:none;">
    <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ÙƒÙˆØ¯</option>
    <option value="ÙƒÙˆØ¯ 1">ÙƒÙˆØ¯ 1</option>
    <option value="ÙƒÙˆØ¯ 2">ÙƒÙˆØ¯ 2</option>
  </select>
  <input type="text" id="paymentNumber" placeholder="Ø±Ù‚Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¹Ø¨Ø± ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´" required>
  <input type="file" id="paymentProof" accept="image/*" required>
  <button type="button" onclick="submitOrder()">ÙŠÙ„Ø§ Ø§Ø´ØªØ±ÙŠ</button>
</form>

<!-- Ø§Ù„Ø¨ÙˆØ¨ Ø£Ø¨ -->
<div id="successPopup">
  <div id="popupMessage"></div>
</div>

<script>
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxNhAfhsY_FRU9UsoK61HzMr_ATVn02xtmrb8hFEny06RlpmGxcdKYWXl5sQwyoOVoD/exec"
  const formData = {
    total: "230",
    orderType: ""
  };

  function hideAll() {
    ["third", "second", "akodna"].forEach(type => {
      document.getElementById("video_" + type).style.display = "none";
      document.getElementById("note_" + type).style.display = "none";
    });
    document.getElementById("orderForm").style.display = "none";
  }

  function startOrder(type) {
    hideAll();
    formData.orderType = {
      "third": "Ù…Ø°ÙƒØ±Ø© Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ",
      "second": "Ù…Ø°ÙƒØ±Ø© Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ",
      "akodna": "Ø£ÙƒÙˆØ§Ø¯Ù†Ø§"
    }[type];

    document.getElementById("video_" + type).style.display = "block";
    document.getElementById("note_" + type).style.display = "block";
    document.getElementById("orderForm").style.display = "block";

    const codeSelect = document.getElementById("codeType");
    const addressField = document.getElementById("address");

    if (type === "akodna") {
      codeSelect.style.display = "block";
      codeSelect.required = true;
      addressField.style.display = "none";
      addressField.required = false;
    } else {
      codeSelect.style.display = "none";
      codeSelect.required = false;
      addressField.style.display = "block";
      addressField.required = true;
    }
  }

  function submitOrder() {
    const name = document.getElementById("name").value;
    const gov = document.getElementById("gov").value;
    const phone1 = document.getElementById("phone1").value;
    const address = document.getElementById("address").value;
    const paymentNumber = document.getElementById("paymentNumber").value;
    const codeType = document.getElementById("codeType").value;
    const file = document.getElementById("paymentProof").files[0];

    if (!paymentNumber || !file) return;

    const popup = document.getElementById("successPopup");
    const msg = document.getElementById("popupMessage");

    msg.innerHTML = `<div class="loading-msg">ğŸ“¦ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø´Ø­Ù†...<br><span style="display:inline-block; animation: bounce 1s infinite;">â³</span></div>`;
    popup.classList.add("show");

    const reader = new FileReader();
    reader.onload = function (e) {
      const proofImage = e.target.result.split(",")[1];

      const payload = {
        ...formData,
        name,
        gov,
        phone1,
        address: formData.orderType === "Ø£ÙƒÙˆØ§Ø¯Ù†Ø§" ? codeType : address,
        paymentNumber,
        proofImage
      };

      fetch(WEB_APP_URL, {
        method: "POST",
        body: JSON.stringify(payload),
        headers: { "Content-Type": "application/json" }
      })
      .then(res => res.json())
      .then(showPopup)
      .catch(() => showPopup({ success: false, error: "ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„" }));
    };
    reader.readAsDataURL(file);
  }

  function showPopup(res) {
    const popup = document.getElementById("successPopup");
    const msg = document.getElementById("popupMessage");

    if (res.success) {
      msg.innerHTML = `
        âœ… <strong>ØªÙ… Ø§Ù„Ø´Ø­Ù† Ø¨Ù†Ø¬Ø§Ø­</strong><br><br>
        ÙƒÙˆØ¯ Ø§Ù„ØªØªØ¨Ø¹: <strong>${res.trackingCode}</strong><br>
        Ø§Ù„Ø§Ø³Ù…: ${document.getElementById("name").value}<br>
        Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©: ${document.getElementById("gov").value}<br>
        Ø§Ù„Ù‡Ø§ØªÙ: ${document.getElementById("phone1").value}
      `;
    } else {
      msg.innerHTML = `âŒ Ø­ØµÙ„Øª Ù…Ø´ÙƒÙ„Ø©: ${res.error || "Ø­Ø§ÙˆÙ„ ØªØ§Ù†ÙŠ"}`;
    }

    popup.classList.add("show");
  }
</script>
</body>
</html>
